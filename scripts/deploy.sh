#!/bin/bash

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è –¥–ª—è GitHub Pages
# –°–ª–µ–¥—É–µ—Ç –ø–æ–¥—Ö–æ–¥—É –∏–∑ –≤–∏–¥–µ–æ: https://www.youtube.com/watch?v=Hbixs7ACvvw

echo "üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π SNK —Å–∞–π—Ç–∞"
echo "=================================="

# 1. –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç –∏–∑ –ø–∞–ø–∫–∏ source (HTML –∏ PDF)
echo "üì¶ –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç..."
cd source
quarto render --to html
quarto render --to pdf
cd ..

# 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ _book —Å–æ–∑–¥–∞–ª—Å—è –∏ –∫–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã
echo "üìã –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –≤ docs..."
if [ -d "source/_book" ]; then
    cp -r source/_book/* docs/
    echo "‚úÖ –§–∞–π–ª—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ"
else
    echo "‚ùå –û—à–∏–±–∫–∞: –ø–∞–ø–∫–∞ source/_book –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
    exit 1
fi

# 3. –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª .nojekyll –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ –¥–ª—è GitHub Pages
echo "üìÑ –°–æ–∑–¥–∞–µ–º .nojekyll –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ..."
touch .nojekyll

# 4. –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª .nojekyll –≤ –ø–∞–ø–∫–µ docs
echo "üìÑ –°–æ–∑–¥–∞–µ–º .nojekyll –≤ –ø–∞–ø–∫–µ docs..."
echo "# This file tells GitHub Pages not to use Jekyll processing" > docs/.nojekyll

# 5. –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ
echo "üîÑ –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è..."
cat > index.html << 'EOF'
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="refresh" content="0; url=./docs/index.html">
    <title>–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ SNK</title>
</head>
<body>
    <p>–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ <a href="./docs/index.html">SNK —Å–∞–π—Ç</a>...</p>
</body>
</html>
EOF

# 6. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ index.html —Å–æ–∑–¥–∞–ª—Å—è
if [ -f "docs/index.html" ]; then
    echo "‚úÖ index.html —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ"
else
    echo "‚ùå –û—à–∏–±–∫–∞: index.html –Ω–µ –Ω–∞–π–¥–µ–Ω"
    exit 1
fi

# 7. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ PDF —Å–æ–∑–¥–∞–ª—Å—è
if [ -f "docs/–ë–∞–∑–∞-–∑–Ω–∞–Ω–∏–π-–°–ù–ö-–∫–∞—Ñ–µ–¥—Ä—ã-—Ñ–∞—Ä–º–∞–∫–æ–ª–æ–≥–∏–∏-–†–æ—Å—Å–∏–π—Å–∫–æ–≥–æ-—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞-–º–µ–¥–∏—Ü–∏–Ω—ã.pdf" ]; then
    echo "‚úÖ PDF —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ"
else
    echo "‚ö†Ô∏è  PDF –Ω–µ –Ω–∞–π–¥–µ–Ω, –Ω–æ —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ"
fi

# 8. –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ git
echo "üìù –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ git..."
git add .

# 9. –°–æ–∑–¥–∞–µ–º –∫–æ–º–º–∏—Ç
echo "üíæ –°–æ–∑–¥–∞–µ–º –∫–æ–º–º–∏—Ç..."
git commit -m "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π: $(date '+%Y-%m-%d %H:%M')"

# 10. –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ GitHub
echo "üì§ –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ GitHub..."
git push origin main

echo ""
echo "‚úÖ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω!"
echo "üåê –°–∞–π—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ 2-5 –º–∏–Ω—É—Ç:"
echo "   https://svtsar.github.io/SNK/"
echo ""
echo "üìã –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å:"
echo "   https://github.com/svtsar/SNK/actions" 